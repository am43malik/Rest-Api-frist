let Joi,jsonwebservise,User,bcrypt,Custumerrorhandler,RefreshTOken;_aae‍.x([["default",()=>_aae‍.o]]);_aae‍.w("joi",[["default",["Joi"],function(v){Joi=v}]]);_aae‍.w("../error/jsonwebtoken",[["default",["jsonwebservise"],function(v){jsonwebservise=v}]]);_aae‍.w("../model/user",[["default",["User"],function(v){User=v}]]);_aae‍.w("bcrypt",[["default",["bcrypt"],function(v){bcrypt=v}]]);_aae‍.w("../error/CustumErrorhandler",[["default",["Custumerrorhandler"],function(v){Custumerrorhandler=v}]]);_aae‍.w("../model/RefreshTOken",[["default",["RefreshTOken"],function(v){RefreshTOken=v}]]);







const registerController = {
  async register(req, res, next) {

   const  registerSchema= Joi.object({
                 name:Joi.string().required(),
                 email:Joi.string().email().required(),
                 password:Joi.string().required(),
                  reppassword:Joi.ref("password")
               })

   
    const {error}= registerSchema.validate(req.body)
    if (error) {
      return next(error);
    }
    
    // User Already Exist....

    try{
      const exist= await User.exists({email:req.body.email})

      if(exist){
       return next(Custumerrorhandler.alradyExist('User Already Exist.'))
 
      }
    }catch(error){
  return next(error)
    }

    // bcrypt password...
    const {name,email,password}=req.body

 const hasdPassword =await bcrypt.hash(password,10)

 let  user = new User  ({
  name,
  email,
  password:hasdPassword
 })


 // save code......
 let access_jwt_token;
 let refresf_jwt_token;



try{

   user= await user.save()


     access_jwt_token= jsonwebservise.sign({_id: user._id, role:user.role})
     refresf_jwt_token= jsonwebservise.sign({_id: user._id, role:user.role},'1y','12fgfggg5y')
      
     await RefreshTOken.create({token:refresf_jwt_token})
      
  }catch(error){
    _aae‍.g.console.log(error)
    return next(error)
  }
  
   res.json({access_jwt_token,refresf_jwt_token});



    
  },
};
_aae‍.d(registerController);



