let Joi,Custumerrorhandler,User,bcrypt,jsonwebservise;_742‍.x([["default",()=>_742‍.o]]);_742‍.w("joi",[["default",["Joi"],function(v){Joi=v}]]);_742‍.w("../error/CustumErrorhandler",[["default",["Custumerrorhandler"],function(v){Custumerrorhandler=v}]]);_742‍.w("../model/user",[["default",["User"],function(v){User=v}]]);_742‍.w("bcrypt",[["default",["bcrypt"],function(v){bcrypt=v}]]);_742‍.w("../error/jsonwebtoken",[["default",["jsonwebservise"],function(v){jsonwebservise=v}]]);





const loginControlle={
   

async login(req,res,next){

    const loginSchma =Joi.object({
        email:Joi.string().email().required(),
                 password:Joi.string().required(),
    })


    const {error}= loginSchma.validate(req.body)
    if (error) {
      return next(error);
    }

// chek pass and email im the database....

try{  

  const user= await  User.findOne({email:req.body.email});
  if(!user){
    return next(Custumerrorhandler.wrongcredentials())

  }
  const password = await bcrypt.compare(req.body.password,user.password)
  if(!password){
    return next(Custumerrorhandler.wrongcredentials())

  }

  let access_jwt_token = jsonwebservise.sign({id:user._id,role:user.role})



  res.json({access_jwt_token})

}catch(err){
    return next(err)

}
  


}




}
_742‍.d(loginControlle);